*** Settings ***
Documentation     This is a resource file, that can contain variables and keywords.
...               Keywords defined here can be used where this Keywords.resource in loaded.
Library           Selenium2Library
Library           OperatingSystem


*** Keywords ***
Buka Browser
    [Arguments]    ${LOGIN URL}    ${BROWSER}
    Open Browser    ${LOGIN URL}    ${BROWSER}
   
Download FILE
   # create unique folder
   ${now}    Get Time    epoch
   ${download directory}    Join Path    ${OUTPUT DIR}    storage
   Create Directory    ${download directory}
   ${chrome options}=    Evaluate    sys.modules['selenium.webdriver'].ChromeOptions()    sys, selenium.webdriver
   # list of plugins to disable. disabling PDF Viewer is necessary so that PDFs are saved rather than displayed
   ${disabled}    Create List    Chrome PDF Viewer
   ${prefs}    Create Dictionary    download.default_directory=${download directory}    plugins.plugins_disabled=${disabled}
   Call Method    ${chrome options}    add_experimental_option    prefs    ${prefs}
   Create Webdriver    Chrome    chrome_options=${chrome options}
   Goto    http://bpbd.semarangkota.go.id/pages/data-bencana
   ${elements} =   Get WebElements   partial link:ownload
   ${len}=     Get Length      ${elements}
   ${idx}=     evaluate    ${len}-1
   ${link}=    Set Variable    ${elements}[${idx}]
   Click Element   ${link}
   Sleep   10s
   # wait for download to finish
   ${file}    Wait Until Keyword Succeeds    1 min    2 sec    Download should be done    ${download directory}

Download should be done
    [Arguments]    ${directory}
    [Documentation]    Verifies that the directory has only one folder and it is not a temp file.
    ...
    ...    Returns path to the file
    ${files}    List Files In Directory    ${directory}
    Length Should Be    ${files}    1    Should be only one file in the download folder
    Should Not Match Regexp    ${files[0]}    (?i).*\\.tmp    Chrome is still downloading a file
    ${file}    Join Path    ${directory}    ${files[0]}
    Log    File was successfully downloaded to ${file}
    [Return]    ${file}
    
Data BPBD
   [Arguments]     ${URL}      ${browser}
   ${now}    Get Time    epoch
   ${download directory}    Join Path    ${OUTPUT DIR}    ${now}
   Create Directory    ${download directory}
   ${chrome options}=    Evaluate    sys.modules['selenium.webdriver'].ChromeOptions()    sys, selenium.webdriver
   # list of plugins to disable. disabling PDF Viewer is necessary so that PDFs are saved rather than displayed
   ${disabled}    Create List    Chrome PDF Viewer
   ${prefs}    Create Dictionary    download.default_directory=${download directory}    plugins.plugins_disabled=${disabled}
   Call Method    ${chrome options}    add_experimental_option    prefs    ${prefs}
   Create Webdriver    Chrome    chrome_options=${chrome options}
   Goto    ${URL}
   ${elements} =   Get WebElements   partial link:ownload
   ${len}=     Get Length      ${elements}
   ${idx}=     evaluate    ${len}-1
   ${link}=    Set Variable    ${elements}[${idx}]
   Click Element   ${link}
   Sleep   10s
   # wait for download to finish
   ${file}    Wait Until Keyword Succeeds    1 min    2 sec    Download should be done    ${download directory}
   RETURN  SUCCESS